
### 【1】开链动力学的定义：

与我们前面学习的运动学类似，但有些不同。

运动学重点在角度$\theta$，速度$V$和姿态$T$

而动力学重点在力$\tau$和质量（我们一般用$\tau$来简代力，因为对于旋转关节来说，$\tau$对应力矩，而对于平动关节来说，$\tau$对应力）

具体就是两个方向：（对于动力学来说，角度，速度都是给定的前提）
- 正向动力学：给出力$\tau$→求解加速度$\ddot{\theta}$：$$\ddot{\theta}=M^{-1}(\theta)\left(\tau-h(\theta,\dot{\theta})\right)$$
- 逆向动力学：给出加速度$\ddot{\theta}$→求解力$\tau$：$$\tau=M(\theta)\ddot{\theta}+h(\theta,\dot{\theta})$$

对于动力学方程可以通过两种方法推导出，
一种是本节重点介绍的拉格朗日方程，其对于具有简单结构或自由度低的情况下非常有效。但是对于复杂结构的机器人这个公式就显得复杂。
另一种是牛顿-欧拉公式，它比较通用一点。


### 【2】拉格朗日方程：

$$\color{#fb8b05}\tau=M(\theta)\ddot{\theta}+\underbrace{c(\theta,\dot{\theta})+g(\theta)}_{h(\theta,\dot{\theta})}$$
*$M(\theta)$称为质量惯性矩阵*
质量惯性矩阵后续详细介绍
*$c(\theta,\dot{\theta})$称为速度乘积项*
关于$c(\theta,\dot{\theta})$最需要了解的就是它是关于速度的二次函数。其也可以写成$\dot{\theta}^\mathrm{T}\Gamma(\theta)\dot{\theta}$代表了$\dot{\theta}$向量平方的写法，即速度的二次函数。
*$g(\theta)$称为重力项*


- 简单推导一下
	先引入一下拉格朗日法求力的公式：拉格朗日函数=整个系统的动能$K(q,\dot{q})$-势能$\mathcal{P}(q)$$$\mathcal{L}(q,\dot{q})=K(q,\dot{q})-\mathcal{P}(q)$$则运动方程可以表示为：$$\tau=\frac{d}{dt}\frac{\partial\mathcal{L}}{\partial\dot{q}}-\frac{\partial\mathcal{L}}{\partial q}$$其中第一项是第一项是先对 $\dot{q}$ 求偏导，再对时间 $t$ 求全导（偏导就是被求导的这个东西里面可能含有很多变量，但是我们只针对某一个变量求导，把其它变量视为常熟）
	第二项是直接对$q$求偏导
	
	所以核心就在于求出动能$K$和势能$P$：
	用一个平面上的$2R$开链机器人做例子：
	![[Pasted image 20250704141615.png]]
	对于连杆1来说，其位置和速度为：$$\left.\left[\begin{array}{c}x_1 \\y_1\end{array}\right.\right]\quad=\quad\begin{bmatrix}L_1\cos\theta_1 \\L_1\sin\theta_1\end{bmatrix}$$$$\left.\left[\begin{array}{c}\dot{x}_1 \\\dot{y}_1\end{array}\right.\right]=\begin{bmatrix}-L_1\sin\theta_1 \\L_1\cos\theta_1\end{bmatrix}\dot{\theta}_1$$而对于连杆2来说，其位置和速度为：$$\begin{bmatrix}x_2 \\y_2\end{bmatrix}=\begin{bmatrix}L_1\cos\theta_1+L_2\cos(\theta_1+\theta_2) \\L_1\sin\theta_1+L_2\sin(\theta_1+\theta_2)\end{bmatrix}$$$$\left.\left[\begin{array}{c}\dot{x}_2 \\\dot{y}_2\end{array}\right.\right]\quad=\quad\begin{bmatrix}-L_1\sin\theta_1-L_2\sin(\theta_1+\theta_2) & -L_2\sin(\theta_1+\theta_2) \\L_1\cos\theta_1+L_2\cos(\theta_1+\theta_2) & L_2\cos(\theta_1+\theta_2)\end{bmatrix}\begin{bmatrix}\dot{\theta}_1 \\\dot{\theta}_2\end{bmatrix}$$则连杆的动能$K_1$和$K_2$分别为：$$\begin{array}{rcl}K_1 & = & \frac{1}{2}\mathfrak{m}_1(\dot{x}_1^2+\dot{y}_1^2)=\frac{1}{2}\mathfrak{m}_1L_1^2\dot{\theta}_1^2\end{array}$$$$\begin{aligned}\mathcal{K}_{2} & =\quad\frac{1}{2}\mathrm{m}_{2}(\dot{x}_{2}^{2}+\dot{y}_{2}^{2}) \\& =\quad\frac{1}{2}\mathrm{m}_{2}\left((L_{1}^{2}+2L_{1}L_{2}\cos\theta_{2}+L_{2}^{2})\dot{\theta}_{1}^{2}+2(L_{2}^{2}+L_{1}L_{2}\cos\theta_{2})\dot{\theta}_{1}\dot{\theta}_{2}+L_{2}^{2}\dot{\theta}_{2}^{2}\right)\end{aligned}$$连杆的势能项$\mathcal{P}_1$和$\mathcal{P}_2$分别为：$$\begin{array}{rcl}P_1 & = & \mathfrak{m}_1gy_1=\mathfrak{m}_1gL_1\sin\theta_1\end{array}$$$$\begin{array}{rcl}\mathcal{P}_2 & = & \mathfrak{m}_2gy_2=\mathfrak{m}_2g(L_1\sin\theta_1+L_2\sin(\theta_1+\theta_2))\end{array}$$结合上面的拉格朗日法式子：$\mathcal{L}(q,\dot{q})=K(q,\dot{q})-\mathcal{P}(q)$和$\tau=\frac{d}{dt}\frac{\partial\mathcal{L}}{\partial\dot{q}}-\frac{\partial\mathcal{L}}{\partial q}$代入得：$$\tau_{1}=({m_{1}L_{1}^{2}+m_{2}(L_{1}^{2}+2L_{1}L_{2}\cos\theta_{2}+L_{2}^{2}))}\dot{\theta}_{1}+m_{2}(L_{1}L_{2}\cos\theta_{2}+L_{2}^{2})\ddot{\theta}_{2}-m_{2}L_{1}L_{2}\sin\theta_{2}(2\dot{\theta}_{1}\dot{\theta}_{2}+\ddot{\theta}_{2})+(m_{1}+m_{2})L_{1}gL\cos\theta_{1}+m_{2}gL_{2}\cos(\theta_{1}+\theta_{2})$$$$\tau_{2}=m_{2}(L_{1}L_{2}\cos\theta_{2}+L_{2}^2)\ddot{\theta}_{2}+m_{2}L_{2}^{2}\ddot{\theta}_{2}+m_{2}L_{1}L_{2}\sin^{2}\theta_{2}+m_{2}gL_{2}\cos(\theta_{1}+\theta_{2})$$
	对同类型的项进行整理，例如把含$\ddot{\theta}$加速度的项都整理起来，得到质量矩阵$M(\theta)$，把含$\dot{\theta}_{1}\dot{\theta}_{2}$这种速度相乘的整理得到速度乘积项$c(\theta,\dot{\theta})$，把含$g$的整理起来得到重力项$g(\theta)$
	得到：$$\tau=M(\theta)\ddot{\theta}+c(\theta,\dot{\theta})+g(\theta)$$式中：$$\begin{aligned}& M(\theta)\left.=\left[\begin{array}{cc}{\mathfrak{m}_{1}L_{1}^{2}+\mathfrak{m}_{2}(L_{1}^{2}+2L_{1}L_{2}\cos\theta_{2}+L_{2}^{2})} & {\mathfrak{m}_{2}(L_{1}L_{2}\cos\theta_{2}+L_{2}^{2})} \\{\mathfrak{m}_{2}(L_{1}L_{2}\cos\theta_{2}+L_{2}^{2})} & {\mathfrak{m}_{2}L_{2}^{2}}\end{array}\right.\right] \\& c(\theta,\dot{\theta})\left.=\left[\begin{array}{c}-\mathfrak{m}_{2}L_{1}L_{2}\sin\theta_{2}(2\dot{\theta}_{1}\dot{\theta}_{2}+\dot{\theta}_{2}^{2}) \\\mathfrak{m}_{2}L_{1}L_{2}\dot{\theta}_{1}^{2}\sin\theta_{2}\end{array}\right.\right], \\& g(\theta)\left.=\left[\begin{array}{c}(\mathfrak{m}_1+\mathfrak{m}_2)L_1g\cos\theta_1+\mathfrak{m}_2gL_2\cos(\theta_1+\theta_2) \\\mathfrak{m}_2gL_2\cos(\theta_1+\theta_2)\end{array}\right.\right],\end{aligned}$$



### 【3】质量矩阵$M(\theta)$：

理解：
传统动能为$K=\frac12mv^Tv$,而在机器人中，广义的动能可以表示为$K=\frac12\dot{\theta}^TM(\theta)\dot{\theta}$
即$\frac12\dot{\theta}^TM(\theta)\dot{\theta}$其实就是动能$\frac12mv^Tv$的矩阵化表达
*这里的$M(\theta)$对应着传统的$m$*

*注意：$M$ 是一个关于关节角度 $θ$ 的函数*
$M$不仅包含了质量，还包含了惯性，结构和姿态等信息。因此是一个随姿态变化的广义惯性质量。（想象滑冰运动员旋转的时候，手臂打开和手臂收紧这两种姿态下的旋转惯性是不一样的）


因此类比到传统的公式$f = ma$，这里$M$对应这里的$m$，其矩阵的性质代表了在不同角速度方向上呈现出不同的有效质量。该质量矩阵的对应元素，代表了这个方向上你需要多大的力/力矩去“加速”它，比如有的方向上很轻松（惯性小），有的方向上就特别“沉重”或“难带动”（惯性大）。


*如果我们把完整的拉格朗日公式只关注“惯性项”这一块的话，就是$\tau=M(\theta)\ddot{\theta}$（暂时单独关注它，它能让我们理解“在不同方向上，加速这个机械臂要花多少力矩”，也就是惯性分布。）*
对应之前的$V=J(\theta)\dot{\theta}$，也可以做一个加速度球→力矩椭球的图。
*$M(\theta)$的力矩椭球*
![[8 第八章/image8/1.png]]

*注意这里的力矩$\tau$指的是各关节的力矩组合，是一个复合的力矩，代表着各关节力矩的协作。*
即要产生这个角速度，各关节力矩该如何协同产生加速度。


然后对于我们刚刚提到的动能可以这么表示$K=\frac12\dot{\theta}^TM(\theta)\dot{\theta}$，这里关注的是整条机械臂的总动能，那我们如果只关注末端执行器的动能的话，就可以结合$V=J(\theta)\dot{\theta}$关节速度对末端速度的映射来推出：$$\frac{1}{2}\dot{\theta}^{\mathrm{T}}M(\theta)\dot{\theta}=\frac{1}{2}V^{\mathrm{T}}\Lambda(\theta)V$$$$\Lambda(\theta)=J^{-\mathrm{T}}(\theta)M(\theta)J^{-1}(\theta)$$*这个$\Lambda(\theta)$就是末端执行器的质量矩阵*
因此类似地也可以进行椭球映射
![[8 第八章/image8/2.png]]
这个映射出来的是末端的力矩，想象末端执行器是拳头，这个椭球就是拳头在不同方向能打出的最大力量。

关于这两个椭球，跟之前类似的，主轴方向都是特征向量，主轴长度都是特征值。
其扁平程度代表了，例如：
场景：机械臂抓取物体
- $M(\theta)$椭球：  
    决定如何分配关节力矩，使机械臂快速加速到目标位置（动态性能）。
    若椭球在某一方向“瘦长”，表示该方向惯性大，需更大关节力矩。
- $\Lambda(\theta)$椭球：  
    决定末端能否稳稳握住物体（静态力控）。
    若椭球在抓取方向“扁平”，表示末端夹持力不足，可能滑脱。
    (这个椭球和之前学的力椭球比较类似，但是之前学的力椭球主要在于力的传递是一种静态的概念，这里因为跟加速度息息相关所以是一个动态的概念)