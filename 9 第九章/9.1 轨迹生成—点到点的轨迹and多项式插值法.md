
### 【1】定义：

1*轨迹*：机器人位置关于时间$t$的函数就称为轨迹，$t \in [0, T]$
![[9 第九章/image9/1.png]]

2同时还有另一种定义方式，
*路径*：机器人位置关于$s$路径参数的函数称为路径
![[9 第九章/image9/2.png]]
*路径参数$s$可以理解为一个抽象的进度条参数，$s \in [0, 1]$。告诉你这条路径你完成的比例*。

也可以理解为$s$像一个连续的数组下标，从0到1，把整条轨迹从初始构型$\theta_A$到$\theta_A$，视作连续的多个点状态放进去。

3因为$\theta$本身还是根据$t$的一个东西，所以需要把$s$跟$t$联系起来。
这里再引入*时间标度*：$s(t)$，$s ： [0, T]→[0, 1]$
具体可以理解为*进度条跟时间*的关系。
![[9 第九章/image9/3.png]]
举个例子，假设你写了一个机器人从家走到超市的路径 $\theta(s)$，这时候需要你设计时间标度$s(t)$，其代表了你走的速度，你可与选择匀速走$s(t)=t​/10$。或者先快后慢走：$s(t)=t^2​/100$


所以总得来说。轨迹=路径+时间标度。


### 【2】点到点的直线轨迹：

先从最简单的运动类型，静止点到另一静止点的直线最短路径说起：

- 1，关节的”直线“运动：
	我们可以定义关节空间中从起始角度$\theta_{start}$到目标角度$\theta_{end}$这样是一条”直线“路径
	![[9 第九章/image9/4.png]]
	
	注意：这里只是关节角度空间（C-space）上的所谓“直线”路径！实际比如说旋转关节从实际上也并不是做直线运动，包括整个机器人的末端也不一定做直线运动。
	*关节空间的”直线“运动的路径公式*：$$\color{#fb8b05}\theta(s)=\theta_{\text {start }}+s\left(\theta_{\text {end }}-\theta_{\text {start }}\right)$$其导数为：$$\begin{aligned}\frac{d \theta}{d s} & =\theta_{\mathrm{end}}-\theta_{\mathrm{start}} \\\frac{d^2 \theta}{d s^2} & =0\end{aligned}$$注意这里没有给出明确的$s(t)$所以默认$s(t)=t$这种匀速处理。所以可以看到一阶导速度为常数，而二阶导加速度为0。

- 2，末端执行器的“直线”运动。
	因为关节的直线运动并不一定会使末端也进行直线运动，所以针对末端点到点的”直线“运动，我们可以把其看作末端执行器坐标轴的移动，这样我们就可以使用位姿矩阵来解决问题。$$X_{\text {start }, \text { end }}=X_{\text {start }, s} X_{s, \text { end }}=X_{s, \text { start }}^{-1} X_{s, \text { end }}$$推导一下，在[[3.7 刚体运动的指数坐标]]中我们学过这个公式$T=e^{[\mathcal{S}]\theta}$
	
	在这里即从起点$X_\mathrm{start}$到终点$X_\mathrm{end}$的运动$X_\mathrm{start}^{-1}X_\mathrm{end}=e^{[\mathcal{S}]\theta}$
	
	进行对数逆运算一下$\log(X_{\mathrm{start}}^{-1}X_{\mathrm{end}})=[\mathcal{S}]\theta$
	
	用一个$s$表示进度比例$[\mathcal{S}]\theta{s}$
	
	即中间位姿矩阵：$e^{[\mathcal{S}]^{\wedge}\theta s}=\exp\left(\log(X_{\mathrm{start}}^{-1}X_{\mathrm{end}})s\right)$
	
	最后推出*末端“直线”运动的路径公式*：$$\color{#fb8b05}X(s)=X_{\mathrm{start}}\cdot e^{[\mathcal{S}]^\wedge\theta s}=X_{\mathrm{start}}\exp\left(\log(X_{\mathrm{start}}^{-1}X_{\mathrm{end}})s\right)$$注意这里所谓末端的直线运动也是广义上的直线运动，因为看作的是沿着螺旋轴的直线运动$S\theta$（指数坐标）。在实际上是一种螺旋运动![[9 第九章/image9/5.png]]
	我们为了简化分析，也可以使用解耦的方法。把整体螺旋的复合运动拆成平移和旋转。$$\begin{aligned}& p(s)=p_{\mathrm{start}}+s(p_{\mathrm{end}}-p_{\mathrm{start}}), \\& R(s)=R_{\mathrm{start}}\exp(\log(R_{\mathrm{start}}^{\mathrm{T}}R_{\mathrm{end}})s)\end{aligned}$$这样平移在空间就显示为直线，然后旋转就是自身坐标系的旋转。
	注意这种方法只是为了数学上简化分析！实际上还是螺旋运动。


- 3，直线轨迹的*时间标度设计*
	前面都是讲路径$\theta(s)$，接下来我们来讨论一下时间标度$s(t)$的设计。
	（1），*三次多项式*：
	一种最为简单的时间标度设计$$s(t)=a_0+a_1t+a_2t^2+a_3t^3$$然后根据起始和终止的条件进行解方程$$s(0)=0,\dot{s}(0)=0,s(T)=1,\dot{s}(T)=0$$解得$a_0=0,\quad a_1=0,\quad a_2=\frac{3}{T^2},\quad a_3=-\frac{2}{T^3}$
	这样我们可以绘制出对应的图像为：![[9 第九章/image9/6.png]]
	可以发现这种方法；速度在始末状态下确实为0，但是加速度不为0。这种加速度的跳变可能会引起机械系统的振动。因此引入更高精度更稳定的五次多项式。
	
	（2），*五次多项式*：
	类似上面，$$s(t)=a_{0}+\cdots+a_{5}t^{5}$$因为添加了两个项数，所以引入两个新的约束，在始末状态下的加速度为0，$\ddot{s}(0)=\ddot{s}(T)=0$。最后一样的解方程就可以解出这五个项数。
	相比三次多项式，运动更平滑，精度更高，始末加速度为0过渡平滑，但是计算的复杂度更高一点。![[9 第九章/image9/7.png]]

	（3），*梯形时间标度*：
	这种设计方式在单关节电机控制中很常见，它的特点是在不超过速度和加速度限制的情况下，实现总运动时间$T$最短。因为其加减速的加速度都是最大的。![[9 第九章/image9/8.png]]
	但是相较于三次多项式不够平滑，而且加速度突变的问题依旧存在。
	对于梯形曲线，$v,a,T$这三个参数可以由2推另1。

	（4），*S-曲线时间标度*：
	正如五次多项式能解决三次多项式加速度突变的问题一样，S-曲线能解决梯形曲线加速度突变的问题。
	S-曲线分为七个阶段：
	(1)恒定的加加速度$d^3s/dt=J$直到达到期望的加速度$\ddot{s}=a$(2)恒定加速至$\dot{s}=v$ 
	(3)在$\dot{s}=v$时有恒定的负加加速度 $-J$直到$\ddot{s}=0$ 
	(4)以恒定速度v运动
	(5)恒定的$-J$ 
	(6)恒定的加速度$-a$
	(7) 恒定的$J$在时间达到T时$\ddot{s}=\dot{s}=0$ 。
	![[9 第九章/image9/9.png]]



### 【3】，多项式中间点的轨迹
如果目标是让机器人关节在指定时间通过一系列点，而对点之间的路径形状没有严格规定，那么较为简单的方法就是用多项式插值直接寻找关节轨迹$\theta(t)$

(分段每一段都用三次多项式连接)只关注一个关节变量并记为$\beta$ ,那么在每个通过点$i\in\{1,\ldots,k\}$ ,机器人期望走过的点为$\beta(T_i)=\beta_i$ ,速度为$\dot{\beta}(T_i)=\dot{\beta}_i$ ,相应的期望轨迹就有$k-1$段，每段的长度记为$\Delta T_j=T_{j+1}-T_j,j\in\{1,\ldots,k-1\}$ ,将每一段$j$的轨迹表示为三阶多项式：$$\beta(T_j+\Delta t)=a_{j0}+a_{j1}\Delta t+a_{j2}\Delta t^2+a_{j3}\Delta t^3$$然后这种方法是*指定中间点的速度和时间（加速度*)来求的，$$\begin{aligned}
 & \beta(T_{j})=\beta_{j}, & & \dot{\beta}(T_{j})=\dot{\beta}_{j}, \\
 & \beta(T_{j}+\Delta T_{j})=\beta_{j+1}, & & \dot{\beta}(T_{j}+\Delta T_{j})=\dot{\beta}_{j+1}.
\end{aligned}$$类似地解方程得到4个项数。$$\begin{aligned}
 & a_{j0}=\beta_{j}, \\
 & a_{j1}=\dot{\beta}_{j}, \\
 & a_{j2}=\frac{3\beta_{j+1}-3\beta_{j}-2\dot{\beta}_{j}\Delta T_{j}-\dot{\beta}_{j+1}\Delta T_{j}}{\Delta T_{j}^{2}}, \\
 & a_{j3}=\frac{2\beta_{j}+(\dot{\beta}_{j}+\dot{\beta}_{j+1})\Delta T_{j}-2\beta_{j+1}}{\Delta T_{i}^{3}}.
\end{aligned}$$![[9 第九章/image9/10.png]]
我们可以通过中间点的”位置“，”速度“,"时间"三者其二的合理组合来改善插值轨迹的质量。例如上图有右边就是指定位置和时间的插值轨迹，更加平滑。
![[9 第九章/image9/11.png]]
这种方法依旧可能会出现加速度的突变情况，所以也可以使用五次多项式来解决这个问题。