如果路径$\theta(s)$已经由任务完全指定（例如预先规划的轨迹）或由避障路径规划器（如基于采样的算法或优化方法）生成时，路径规划问题就简化为设计时间标度 $s(t)$的问题。
可以根据不同需求（如用时最短，能耗最低等）调整设计不同的$s(t)$。
其中一个时间标度的设计就是*时间最优标度——即总用时最短。*

- 1，推导加速度约束：
	由第8章动力学可知，$\tau=M(\theta)\ddot{\theta}+c(\theta,\dot{\theta})+g(\theta)$，我们把$c(\theta,\dot{\theta})$写作$\dot{\theta}^\mathrm{T}\Gamma(\theta)\dot{\theta}$，即$$\tau=M(\theta)\ddot{\theta}+\dot{\theta}^\mathrm{T}\Gamma(\theta)\dot{\theta}+g(\theta)$$对于给定的路径$\theta(s)$，其速度和加速度为：$$\dot{\theta}=\frac{d \theta}{d s}, \quad \ddot{\theta}=\frac{d \theta}{d s} \ddot{s}+\frac{d^2 \theta}{d s^2} \dot{s}^2$$代入得：$$\underbrace{\left(M(\theta(s)) \frac{d \theta}{d s}\right)}_{m(s) \in \mathbb{R}^n} \ddot{s}+\underbrace{\left(M(\theta(s)) \frac{d^2 \theta}{d s^2}+\left(\frac{d \theta}{d s}\right)^{\mathrm{T}} \Gamma(\theta(s)) \frac{d \theta}{d s}\right)}_{c(s) \in \mathbb{R}^n} \dot{s}^2+\underbrace{g(\theta(s))}_{g(s) \in \mathbb{R}^n}=\tau,$$写作更加紧凑的形式为：$\tau=m(s)\ddot{s}+c(s)\dot{s}^2+g(s)$
	而对应第$i$个关节来说，其的力矩极限为：$\tau_i^{\min }(\theta, \dot{\theta}) \leq \tau_i \leq \tau_i^{\max }(\theta, \dot{\theta})$
	因此代入得：$\tau_i^{\min }(\theta, \dot{\theta}) \leq m(s)\ddot{s}+c(s)\dot{s}^2+g(s) \leq \tau_i^{\max }(\theta, \dot{\theta})$
	记$L_i(s,\dot{s})$为上式中第$i$个关节加速度$\ddot{s}$的最小值，而$U_i(s,\dot{s})$为上式中第$i$个关节加速度$\ddot{s}$的最大值
	因此可以把所有的$L_i(s,\dot{s})$和$U_i(s,\dot{s})$求出来。$$\begin{aligned}\text { if } m_i(s)>0, & L_i(s, \dot{s})=\frac{\tau_i^{\min }(s, \dot{s})-c(s) \dot{s}^2-g(s)}{m_i(s)}, \\U_i(s, \dot{s}) & =\frac{\tau_i^{\max }(s, \dot{s})-c(s) \dot{s}^2-g(s)}{m_i(s)} \\\text { if } m_i(s)<0, & L_i(s, \dot{s})=\frac{\tau_i^{\max }(s, \dot{s})-c(s) \dot{s}^2-g(s)}{m_i(s)}, \\U_i(s, \dot{s}) & =\frac{\tau_i^{\min }(s, \dot{s})-c(s) \dot{s}^2-g(s)}{m_i(s)}\end{aligned}$$之后总体的最小加速度$L(s,\dot{s})=maxL_i(s,\dot{s})$即所有最小值中的最大值。
	类似的，总体最大加速度$U(s,\dot{s})=minU_i(s,\dot{s})$即所有最大值中的最小值。
	因此*总体的加速度约束为*：$$\color{#fb8b05}L(s,\dot{s}) \leq \ddot{s} \leq U(s,\dot{s})$$


- 2，$(s,\dot{s})$相平面
	![[Pasted image 20250708142840.png]]
	构造一个坐标系，横轴为$s$，纵轴为$\dot{s}$。我们的目标就是$s(0)=0$，$s(T)=1$，$\dot{s}(0)=0$，$\dot{s}(T)=0$.然后因为$s(t)$是单调递增的（肯定不能回头跑啊），所有我们只用关注第一象限就行。
	然后在这个象限中画一条符合要求的曲线就是我们所要求的东西。

- 3，可行运动锥体
	在上述的$(s,\dot{s})$相平面曲线中，随便取一点做曲线的切线。
	![[Pasted image 20250708143500.png]]
	因为我们之前讲过了加速度的限制范围，所以我们可以把加速度的范围在这里画出来
	![[Pasted image 20250708143550.png]]
	这个就是“*可行运动锥体*”
	换句话也就是曲线的切向量必须在这个可行运动锥体范围内（满足加速度的约束）
	![[Pasted image 20250708143829.png]]
	注意：$L(s,\dot{s})$和$U(s,\dot{s})$都是与$s$和$\dot{s}$相关的函数，也就是说在$(s,\dot{s})$相平面内，不同点的对应的可行运动锥体是不一样的！


- 4，速度极限曲线：
	在我们之前求$L(s,\dot{s})$和$U(s,\dot{s})$的时候，可能会在一些位置出现$L(s,\dot{s})>U(s,\dot{s})$的情况，这种情况是不合理的，机器人无法在该路径上运动。
	（整体的$L$是所有$L_i$中最大的，然后$U$是所有$U_i$中最小的，可能会出现，最大的$L_i$>最小$U_i$的情况，就会使得整体$L(s,\dot{s})>U(s,\dot{s})$）
	因此$L=U$我们就称为速度极限曲线，在它之上为不可行区域，即$L>U$
	![[Pasted image 20250708144545.png]]
	如图中灰色部分就是不可行区域，图中的曲线也不满足可行运动锥体。


- 5，开关式$bang-bang$轨迹：
	因为要总用时最短，所以我们需要在满足要求的情况下，尽可能地加速和减速。
	![[Pasted image 20250708144845.png]]
	图中就是$bang-bang$轨迹
	在前半段，始终保持着曲线的切线与可行运动锥体的上限，也就是$U(s,\dot{s})$贴紧，即尽可能地以最大加速度进行加速。
	在后半段，始终保持着曲线的切线与可行运动锥体的下限，也就是$L(s,\dot{s})$贴紧，即尽可能地以最大加速度（负的）进行减速。
	（这里默认$L(s,\dot{s})<0$，因为如果$L(s,\dot{s})>0$的话，那系统无法主动减速，减速需要依靠外力或者重新规划路径，这比较复杂，所以这里默认$L(s,\dot{s})$为负数）
	
	但是有时候速度极限曲线的不可行区域会与$bang-bang$轨迹有重合，这时候就要用一个时间标度的算法了。
	![[Pasted image 20250708145415.png]]


- 6，时间标度算法：
	第一步：先从终点 `(1, 0)` 开始反向积分$L$ 曲线![[Pasted image 20250708145559.png]]
	第二步：再从起点 `(0, 0)` 正向积分 $U$ 曲线![[Pasted image 20250708145631.png]]
	第三步：然后记$U$碰到速度极限曲线的点$x$坐标，然后在这个$x$坐标所对应的竖线上开始做一个$L$的曲线。多尝试几次，直到$L$曲线与速度极限曲线相切。然后取这段，并且延申到刚刚竖线的左边与$U$曲线相交。![[Pasted image 20250708145737.png]]
	第四步：类似地尝试做U曲线，直到与速度极限曲线相切，然后延申与右边的L曲线相交。![[Pasted image 20250708145811.png]]
	这样保证了满足速度极限曲线的同时，以最大的加速度进行加速/减速，从而使得总时间最短。
	但是加速度不连续的问题可能使得振动。